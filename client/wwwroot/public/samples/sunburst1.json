{ 
  "title": "3D Sunburst Chart", 
  "description": "3D Sunburst chart with rotated labels",

  "width": 640,
  "depth": 640,
  "height": 90,

  "camera": {"position": [0, 1.5, 1], "target": [0, -0.2, 0]},
  
  "data": [
    {
      "name": "table", 
      "url": "data/hierarachy_levels_4_rows_110.csv",
      "format": {"type": "csv"},
      "transform": [
        {"type": "stratify", "key": "id", "parentKey": "parent"},
        {"type": "partition", "field": "value", "size": {"signal": "[2*PI, width/2]"}, "as": ["x0", "y0", "x1", "y1", "depth", "children", "size0", "descendents"]},
        {"type": "formula", "expr": "(datum.x0+datum.x1)/2", "as": "xc"},
        {"type": "formula", "expr": "(datum.y0+datum.y1)/2", "as": "yc"},
        {"type": "_filter", "expr": "datum.depth>0"}
      ]
    }
  ],

  "scales": [
    {
      "name": "size",
      "type": "linear",
      "domain": {"data": "table", "field": "size0"},
      "range": "height"
    },
    {
      "name": "hue",
      "type": "linear",
      "domain": {"data": "table", "field": "xc"},
      "range": [0,360]
    },
    {
      "name": "saturation",
      "type": "linear",
      "domain": {"data": "table", "field": "y0"},
      "range": [0,0.8]
    }
  ],

  "marks": [
    {
      "type": "rect",
      "geometry": "xzrect",
      "encode": {
        "enter": {
          "xc": {"signal": "width/2"},
          "zc": {"signal": "depth/2"},
          "yc": {"value": -0.1},
          "width": {"signal": "width*2"},
          "depth": {"signal": "depth*2"},
          "fill": {"value": "white"}
        }
      }
    },
    {
      "type": "arc",
      "material": "metal",
      "from": {"data": "table"},
      "encode": {
        "enter": {
          "x": {"signal": "width/2"},
          "z": {"signal": "depth/2"},
          "y": {"scale": "size", "field": "size0", "mult": 0.5},
          "depth": {"scale": "size", "field": "size0"},
          "startAngle": {"field": "x0"},
          "endAngle": {"field": "x1"},
          "innerRadius": {"field": "y0"},
          "outerRadius": {"field": "y1", "offset": -1},
          "padding": {"signal": "datum.depth>0?0.1:0"},
          "fuzz": {"value": 1},
          "angleX": {"value": 90},
          "fill": {
            "color": {
              "h": {"scale": "hue", "field": "xc"},
              "s": {"scale": "saturation", "field": "y0"},
              "l": {"value": 1}
            }
          }
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "table"},
      "encode": {
        "enter": {
          "x": {"signal": "width/2"},
          "z": {"signal": "depth/2"},
          "y": {"scale": "size", "field": "size0", "offset": 0.1},
          "align": {"value": "center"},
          "radius": {"field": "yc"},
          "theta": {"field": "xc"},
          "text": {"field": "name"},
          "angleX": {"value": 90},
          "angleY": {"field": "xc", "offset": {"signal": "datum.xc<PI?-90:90"}, "mult": 57.29577951},
          "fontSize": {"signal": "min(1.5*(datum.y1-datum.y0)/length(datum.name),(datum.y0+datum.y1)*(datum.x1-datum.x0)/2)"},
          "fill": {"value": "black"},
          "angleX2": {"value": 90}
        }
      }
    }
  ]
}